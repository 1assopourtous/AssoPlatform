name: Deploy Flutter Web to Cloudflare Pages

on:
  push:
    branches: [ main ]

# üëâ –¥–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∞ –∑–¥–µ—Å—å (–æ—Ç—Å—Ç—É–ø –±–µ–∑ jobs)
permissions:
  contents: read        # —á—Ç–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
  deployments: write    # —Å–æ–∑–¥–∞–Ω–∏–µ Deployment-–∑–∞–ø–∏—Å–∏

jobs:
  build-deploy:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: frontend      # –≤–µ—Å—å Flutter-–∫–æ–¥ –∑–¥–µ—Å—å

    steps:
      - uses: actions/checkout@v4

      # 1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Flutter -------------------------------------------------
      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.22.0'
          cache: true

      # 2. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ + –±–∏–ª–¥ -----------------------------------------------------
      - run: flutter pub get
      - run: flutter build web --release

      # 3. –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Cloudflare Pages -----------------------------------------
      - name: Publish to Pages
        uses: cloudflare/pages-action@v1
        with:
          apiToken:    ${{ secrets.CF_PAGES_TOKEN }}
          accountId:   ${{ secrets.CF_ACCOUNT_ID }}
          projectName: assopourtous-site   # slug Pages-–ø—Ä–æ–µ–∫—Ç–∞
          directory:   build/web
          gitHubToken: ${{ secrets.GITHUB_TOKEN }}
